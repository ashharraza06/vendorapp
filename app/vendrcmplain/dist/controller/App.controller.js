sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/services/UserInfo"],function(e,t,a,o){"use strict";var n;var i;var r;var s;var l;var g;var d;var p;var u;var c;var m=(new sap.ushell.services.UserInfo).getEmail();var b;let h=[];return e.extend("vendrcmplain.controller.App",{onInit:async function(e){debugger;let t="submitcomplaints";let a=this.getView().getModel().bindContext(`/${t}(...)`);var o=JSON.stringify({panno:m});a.setParameter("data",o);a.setParameter("status",JSON.stringify({status:"getvendor"}));await a.execute();debugger;let n=a.getBoundContext();let r=n.getValue();let s=r.value;s=JSON.parse(s);i=s[0].vencode;debugger;this.byId("screen1").attachBrowserEvent("click",function(e){porowchange(e)});var l=this.getOwnerComponent().createComponent({usage:"screen1",async:true,manifest:true});l.then(function(e){debugger;this.byId("screen1").setComponent(e);this._customerDetailContainer=e}.bind(this));this._wizard=this.byId("VendorComplain");this._oNavContainer=this.byId("wizardNavContainer");this._oWizardContentPage=this.byId("wizardContentPage");e.oSource.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false)},b:function(e){debugger},StepTwo:function(e){debugger;e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false);e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[3].setVisible(false)},StepThree:function(e){debugger;sap.ui.getCore().byId("application-vednorinfor-Display-component---App--step2").setVisible(false);var t=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable")._aSelectedPaths[0];if(t!==null&&typeof t!=="undefined"&&r!=="-"){r=t.substring(t.indexOf("(")+1,t.indexOf(")"));r=t.match(/\('([^']+)'\)/)[1];var a=this.byId("complainTable").mBindingInfos.items.binding;a.filter([new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:r}),new sap.ui.model.Filter({path:"cvencode",operator:sap.ui.model.FilterOperator.EQ,value1:i})]);console.log(r)}var o=null;var n=this.byId("11").mAggregations.items[0].mBindingInfos.items.binding;n.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:o}));if(!g){e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false)}else{e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(true)}e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[2].setVisible(false);this.byId("vencode").setText(i);this.byId("pono").setText(r)},textchange:function(e){debugger;g=this.byId("textcomp").getValue();var t=this.byId("VendorComplain").getCurrentStep();var a=t.split("--");var o=a[a.length-1];if(o!="ReviewStep"){if(g!=""){this.byId("textcomp").setValueState("None");this.byId("textcomp").setValueStateText("");this.byId("revbtn").setVisible(true)}else{this.byId("revbtn").setVisible(false);this.byId("textcomp").setValueState("Error");this.byId("textcomp").setValueStateText("Value is required")}}var n=this.byId("ordr").mProperties.selectedKey;let i=this.byId("ordr").mForwardedAggregations.items;for(var r=0;r<5;r++){var s=i[r].mProperties.key;if(n==s){l=i[r].mProperties.text;break}}this.byId("typ_val").setText(l);this.byId("dsc_val").setValue(g)},StepFour:function(e){debugger;g=this.byId("textcomp").getValue();e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false);e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[3].setVisible(true);var t=this.byId("revPoTable").mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"pono",operator:sap.ui.model.FilterOperator.EQ,value1:r}));var a=null;var o=this.byId("112").mAggregations.items[0].mBindingInfos.items.binding;o.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:a}));this.byId("pan_val").setText(s);this.byId("ven_val").setText(i);this.byId("po_val").setText(r);this.byId("typ_val").setText(l);this.byId("dsc_val").setValue(g)},editStepOne:function(){debugger;this._handleNavigationToStep(0)},editStepTwo:function(){debugger;this._handleNavigationToStep(1)},handleWizardBack:function(){debugger;this._handleNavigationToStep(2)},onListPressed:async function(e){debugger;var t=e.oSource.mAggregations.cells[0].mProperties.text;c=this.byId("ta");var a=JSON.stringify({complainno:t});let o="submitcomplaints";debugger;let n=this.getView().getModel().bindContext(`/${o}(...)`);n.setParameter("data",a);n.setParameter("status",JSON.stringify({status:"getComp"}));await n.execute();debugger;let i=n.getBoundContext();let r=i.getValue();let s=r.value;s=JSON.parse(s);if(s[0].cpono=="-"){this.byId("povw").setVisible(false)}else{this.byId("po_valvw").setText(s[0].cpono)}this.byId("ven_valvw").setText(s[0].cvencode);this.byId("pan_valvw").setText(s[0].cpannum);this.byId("status_valvw").setText(s[0].cstatus);this.byId("typ_valvw").setText(s[0].ccomplain_about);this.byId("dsc_valvw").setValue(s[0].cdesc);this.byId("comp_valvw").setText(s[0].complainno);var l=s[0].complainno;var g=this.byId("112vw").mAggregations.items[0].mBindingInfos.items.binding;g.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:l}));this._oNavContainer.to(this.byId("wizardReviewPage"))},change:function(e){debugger;var t=e.mParameters.step.mProperties.title;if(t=="Preview"){var a=null;var o=this.byId("112").mAggregations.items[0].mBindingInfos.items.binding;o.filter(new sap.ui.model.Filter({path:"size",operator:sap.ui.model.FilterOperator.NE,value1:null}));o.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:null}))}var n=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable")._aSelectedPaths[0];if(n!==null&&typeof n!=="undefined"){r=n.substring(n.indexOf("(")+1,n.indexOf(")"));r=n.match(/\('([^']+)'\)/)[1];this.byId("po_val").setText(r);this.byId("pono").setText(r);var i=this.byId("complainTable").mBindingInfos.items.binding;i.filter(new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:r}));console.log(r)}if(t=="Preview"){this.byId("subbtn").setVisible(true)}else{this.byId("subbtn").setVisible(false)}},reviewPress:function(){this._wizard.setCurrentStep(this.byId("ReviewStep"))},withoutpo:function(e){debugger;this._wizard.discardProgress(this._wizard.getSteps()[0]);r="-";this._wizard.setCurrentStep(this.byId("PoStep"));this.byId("selPObox").setVisible(false);this.byId("poVbox").setVisible(false);this.byId("VendorComplain").nextStep();var t=this.byId("complainTable").mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:r}),new sap.ui.model.Filter({path:"cvencode",operator:sap.ui.model.FilterOperator.EQ,value1:i}))},Step2btn:function(e){debugger;sap.ui.getCore().byId("application-vednorinfor-Display-component---App--step2").setVisible(false);this._wizard.setCurrentStep(this.byId("PoStep"));this.byId("VendorComplain").nextStep()},porowchange:function(e){debugger},onPress:function(e){debugger},wizardCompletedHandler:function(){debugger},_handleNavigationToStep:function(e){var t=function(){this._wizard.goToStep(this._wizard.getSteps()[e]);this._oNavContainer.detachAfterNavigate(t)}.bind(this);this._oNavContainer.attachAfterNavigate(t);this.backToWizardContent()},backToWizardContent:function(){this._oNavContainer.backToPage(this._oWizardContentPage.getId())},handleWizardCancel:function(e){debugger;var t=new sap.m.Dialog({title:"Cancel",resizable:true,draggable:true,content:[new sap.m.Label({text:"Are you sure you want to cancel?"})],buttons:[new sap.m.Button({text:"Yes",press:function(){debugger;t.close();sap.m.MessageToast.show("Cancelled");this._handleNavigationToStep(0);location.reload();this._wizard.discardProgress(this._wizard.getSteps()[0])}.bind(this)}),new sap.m.Button({text:"No",press:function(){t.close()}})]}).addStyleClass("myCustomDialogClass");t.open()},handleWizardSubmit:async function(e){debugger;let t="submitcomplaints";let a=this.oView.getModel().bindContext(`/${t}(...)`);let o="triggerProcess";let n=this.oView.getModel().bindContext(`/${o}(...)`);var c=new sap.m.Dialog({title:"Submit",resizable:true,draggable:true,content:[new sap.m.Label({text:"Are you sure you want to submit for approval?"})],buttons:[new sap.m.Button({text:"Yes",press:async function(){debugger;c.close();var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var o=t+"-"+e;u=o.toString();var n="Complaint No "+u+" sent for approval";sap.m.MessageToast.show(n);var m=this.oView.getModel().sServiceUrl;for(var b=0;b<h.length;b++){var v=h[b];let e=JSON.stringify({ID:v,complaintno:u});var f=m+`files/`+v;$.ajax({url:f,type:"PATCH",contentType:"application/json",data:e,success:function(e){debugger;console.log(e)},error:function(e,t,a){debugger;console.error(t,a)}})}d="Submitted";p="0";var y=this.oView.getModel().sServiceUrl;var w=JSON.stringify({complainno:u,cpono:r,cvencode:i,cpannum:s,cstatus:d,ccomplain_about:l,cdesc:g,days:p});var I=JSON.stringify({complainno:u,cpono:r,cvencode:i,cpannum:s,cstatus:d,ccomplain_about:l,cdesc:g,days:p,baseurl:y});a.setParameter("data",w);a.setParameter("status",JSON.stringify({status:"postComp"}));await a.execute();a.setParameter("data",w);a.setParameter("status",JSON.stringify({status:"getlevel"}));await a.execute();let P=a.getBoundContext();let S=P.getValue();let x=S.value;x=JSON.parse(x);for(var b=0;b<x.length;b++){var C=x[b].level;var T=x[b].employeid;const e=new Date;const t=String(e.getDate()).padStart(2,"0");const o=String(e.getMonth()+1).padStart(2,"0");const n=e.getFullYear();const i=`${t}-${o}-${n}`;var A=JSON.stringify({complainno:u,Begin_DateAND_Time:i,level:C,Employee_ID:T,Notification_Status:d});a.setParameter("data",A);a.setParameter("status",JSON.stringify({status:"postWorkflow"}));await a.execute()}this._handleNavigationToStep(0);this._wizard.discardProgress(this._wizard.getSteps()[0]);location.reload()}.bind(this)}),new sap.m.Button({text:"No",press:function(){c.close();sap.m.MessageToast.show("Cancelled")}})]}).addStyleClass("myCustomDialogClass");c.open()},discardProgress:function(){debugger;this._wizard.discardProgress(this.byId("PanStep"));var e=function(t){for(var a=0;a<t.length;a++){if(t[a].setValue){t[a].setValue("")}if(t[a].getContent){e(t[a].getContent())}}};e(this._wizard.getSteps())},handleSearch:function(e){debugger;var t=this.byId("SearchField").getValue();var a=this.byId("idProductsTable").mBindingInfos.items.binding;if(t===""||t===null||typeof t==="undefined"){a.filter([]);return}var o=[];o.push(new sap.ui.model.Filter({path:"vendor",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"pannum",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"pono",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"type",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"amount",operator:sap.ui.model.FilterOperator.EQ,value1:t}));var n=new sap.ui.model.Filter({filters:o,and:false});a.filter(n)},comments:async function(e){debugger;var t=new sap.m.Dialog({title:"Comments",endButton:new sap.m.Button({text:"Close",press:async function(){t.close()},layoutData:new sap.m.FlexItemData({growFactor:5,alignSelf:"End"})})});t.addContent(new sap.m.VBox({width:"60vw"}));function a(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var a=t+"-"+e;return a}debugger;var o=this.byId("comp_valvw").getText();var n=JSON.stringify({complainno:o});let i="submitcomplaints";debugger;let r=this.getView().getModel().bindContext(`/${i}(...)`);r.setParameter("data",n);r.setParameter("status",JSON.stringify({status:"getComments"}));await r.execute();debugger;let s=r.getBoundContext();let l=s.getValue();let g=l.value;g=JSON.parse(g);var d=g.length;for(var p=0;p<g.length;p++){var u=new sap.suite.ui.commons.TimelineItem("thisuniqid1"+a(),{dateTime:g[p].createdAt,userNameClickable:false,select:b,text:g[p].comments});t.addContent(u)}var m;function b(e){debugger;m=e.getSource().mProperties.text;c.setValue(m);t.close()}t.open()},onAfterItemAdded:function(e){debugger;var t=this.oView.getModel().sServiceUrl;var a=e.getParameter("item");var o=function(e){debugger;var a={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var o={url:t+`files`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(a)};return new Promise((e,t)=>{$.ajax(o).done((t,a,o)=>{e(t.ID);debugger;h.push(t.ID);b=t.ID}).fail(e=>{t(e)})})};o(a).then(e=>{debugger;var o=t+`files(${e})/content`;a.setUploadUrl(o);var n=this.byId("uploadSet");n.setHttpRequestMethod("PUT");n.uploadItem(a)}).catch(e=>{console.log(e)})},onUploadCompleted:async function(e){debugger;var t=this.byId("uploadSet");t.removeAllIncompleteItems();let a="submitcomplaints";var o=this.getView().getModel().bindContext(`/${a}(...)`);var n=JSON.stringify({uid:b,createdBy:m});o.setParameter("data",n);o.setParameter("status",JSON.stringify({status:"patchattach"}));await o.execute();t.getBinding("items").refresh()},onRemovePressed:function(e){debugger;e.preventDefault();e.getParameter("item").getBindingContext().delete();sap.m.MessageToast.show("Selected file has been deleted")},onOpenPressed:function(e){debugger;e.preventDefault();var t=e.getSource();var a=t.getFileName();var o=this.oView.getModel().sServiceUrl;o=o.replace("/odata/v4/my/","");var n=function(e){var t={url:o+e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})};n(t).then(e=>{var t=window.URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>{console.log(e)})},_download:function(e){debugger;var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntity:function(e){debugger;var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/attachments/files",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,o)=>{e(t.ID);debugger;arr.push(t.ID)}).fail(e=>{t(e)})})},_uploadContent:function(e,t){debugger;var a=`/attachments/Files(${t})/content`;e.setUploadUrl(a);var o=this.byId("uploadSet");o.setHttpRequestMethod("PUT");o.uploadItem(e)},formatThumbnailUrl:function(e){debugger;var t;switch(e){case"image/png":t="sap-icon://card";break;case"text/plain":t="sap-icon://document-text";break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":t="sap-icon://excel-attachment";break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":t="sap-icon://doc-attachment";break;case"application/pdf":t="sap-icon://pdf-attachment";break;default:t="sap-icon://attachment"}return t}})});