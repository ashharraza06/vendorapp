sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/services/UserInfo"],function(e,t,a,o){"use strict";var r;var i="VEN111";var n="-";var s;var l;var g;var d;var p;var u;var m;let c=[];return e.extend("vendrcmplain.controller.App",{onInit:function(e){debugger;try{var t=sap.ushell.Container.getService("UserInfo");var a=t.getUser();var o=a.getEmail();console.log("User Email:",o)}catch(e){console.error("An error occurred while accessing user information:",e)}this._wizard=this.byId("VendorComplain");this._oNavContainer=this.byId("wizardNavContainer");this._oWizardContentPage=this.byId("wizardContentPage");e.oSource.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false)},StepTwo:function(e){debugger;e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false);e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[2].setVisible(false)},StepThree:function(e){debugger;var t=null;var a=this.byId("11").mAggregations.items[0].mBindingInfos.items.binding;a.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:t}));if(!g){e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false)}else{e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(true)}e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[2].setVisible(false);this.byId("vencode").setText(i);this.byId("pono").setText(n)},textchange:function(e){debugger;g=this.byId("textcomp").getValue();if(g!=""){this.byId("textcomp").setValueState("None");this.byId("textcomp").setValueStateText("");this.byId("revbtn").setVisible(true)}else{this.byId("revbtn").setVisible(false);this.byId("textcomp").setValueState("Error");this.byId("textcomp").setValueStateText("Value is required")}var t=this.byId("ordr").mProperties.selectedKey;let a=this.byId("ordr").mForwardedAggregations.items;for(var o=0;o<5;o++){var r=a[o].mProperties.key;if(t==r){l=a[o].mProperties.text;break}}this.byId("typ_val").setText(l);this.byId("dsc_val").setValue(g)},StepFour:function(e){debugger;g=this.byId("textcomp").getValue();e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false);e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[2].setVisible(true);var t=this.byId("revpanTable").mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"vencode",operator:sap.ui.model.FilterOperator.EQ,value1:i}));var t=this.byId("revPoTable").mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"pono",operator:sap.ui.model.FilterOperator.EQ,value1:n}));var a=null;var o=this.byId("112").mAggregations.items[0].mBindingInfos.items.binding;o.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:a}));this.byId("pan_val").setText(s);this.byId("ven_val").setText(i);this.byId("po_val").setText(n);this.byId("typ_val").setText(l);this.byId("dsc_val").setValue(g)},editStepOne:function(){debugger;this._handleNavigationToStep(0)},editStepTwo:function(){debugger;this._handleNavigationToStep(1)},handleWizardBack:function(){debugger;this._handleNavigationToStep(2)},onListPressed:async function(e){debugger;var t=e.oSource.mAggregations.cells[0].mProperties.text;m=this.byId("ta");var a=JSON.stringify({complainno:t});let o="submitcomplaints";debugger;let r=this.getView().getModel().bindContext(`/${o}(...)`);r.setParameter("data",a);r.setParameter("status",JSON.stringify({status:"getComp"}));await r.execute();debugger;let i=r.getBoundContext();let n=i.getValue();let s=n.value;s=JSON.parse(s);this.byId("po_valvw").setText(s[0].cpono);this.byId("ven_valvw").setText(s[0].cvencode);this.byId("pan_valvw").setText(s[0].cpannum);this.byId("status_valvw").setText(s[0].cstatus);this.byId("typ_valvw").setText(s[0].ccomplain_about);this.byId("dsc_valvw").setValue(s[0].cdesc);this.byId("comp_valvw").setText(s[0].complainno);var l=s[0].complainno;var g=this.byId("112vw").mAggregations.items[0].mBindingInfos.items.binding;g.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:l}));this._oNavContainer.to(this.byId("wizardReviewPage"))},change:function(e){debugger;var t=e.mParameters.step.mProperties.title;if(t=="Preview"){this.byId("subbtn").setVisible(true)}else{this.byId("subbtn").setVisible(false)}},reviewPress:function(){this._wizard.setCurrentStep(this.byId("ReviewStep"))},withoutpo:function(e){debugger;this._wizard.setCurrentStep(this.byId("PoStep"));this.byId("selPObox").setVisible(false);this.byId("VendorComplain").nextStep();var t=this.byId("complainTable").mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"cvencode",operator:sap.ui.model.FilterOperator.EQ,value1:"VEN111"}))},panrowchange:function(e){debugger;this.byId("textcomp").setValue("");this._wizard.setCurrentStep(this.byId("PanStep"));i=e.mParameters.listItems[0].mAggregations.cells[1].mProperties.text;s=e.mParameters.listItems[0].mAggregations.cells[0].mProperties.text;if(i===null||typeof i==="undefined"){this._wizard.invalidateStep(this.byId("PanStep"))}else{this._wizard.validateStep(this.byId("PanStep"))}var t=this.byId("PoStep").mAggregations.content[0].mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"vendor",operator:sap.ui.model.FilterOperator.EQ,value1:i}));this.byId("VendorComplain").nextStep()},porowchange:function(e){debugger;this.byId("selPObox").setVisible(true);this._wizard.setCurrentStep(this.byId("PoStep"));n=e.mParameters.listItems[0].mAggregations.cells[0].mProperties.text;var t=this.byId("complainTable").mBindingInfos.items.binding;t.filter(new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:n}));if(n===null||typeof n==="undefined"){this._wizard.invalidateStep(this.byId("PoStep"))}else{this._wizard.validateStep(this.byId("PoStep"))}this.byId("VendorComplain").nextStep()},onPress:function(e){debugger},wizardCompletedHandler:function(){debugger},_handleNavigationToStep:function(e){var t=function(){this._wizard.goToStep(this._wizard.getSteps()[e]);this._oNavContainer.detachAfterNavigate(t)}.bind(this);this._oNavContainer.attachAfterNavigate(t);this.backToWizardContent()},backToWizardContent:function(){this._oNavContainer.backToPage(this._oWizardContentPage.getId())},handleWizardCancel:function(e){debugger;var t=new sap.m.Dialog({title:"Cancel",resizable:true,draggable:true,content:[new sap.m.Label({text:"Are you sure you want to cancel?"})],buttons:[new sap.m.Button({text:"Yes",press:function(){debugger;t.close();sap.m.MessageToast.show("Cancelled");this._handleNavigationToStep(0);location.reload();this._wizard.discardProgress(this._wizard.getSteps()[0])}.bind(this)}),new sap.m.Button({text:"No",press:function(){t.close()}})]}).addStyleClass("myCustomDialogClass");t.open()},handleWizardSubmit:async function(e){debugger;let t="submitcomplaints";let a=this.oView.getModel().bindContext(`/${t}(...)`);let o="triggerProcess";let r=this.oView.getModel().bindContext(`/${o}(...)`);var m=new sap.m.Dialog({title:"Submit",resizable:true,draggable:true,content:[new sap.m.Label({text:"Are you sure you want to submit for approval?"})],buttons:[new sap.m.Button({text:"Yes",press:async function(){debugger;m.close();var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var o=t+"-"+e;u=o.toString();var h="Complaint No "+u+" sent for approval";sap.m.MessageToast.show(h);var b=this.oView.getModel().sServiceUrl;for(var v=0;v<c.length;v++){var f=c[v];let e=JSON.stringify({ID:f,complaintno:u});var y=b+`files/`+f;$.ajax({url:y,type:"PATCH",contentType:"application/json",data:e,success:function(e){debugger;console.log(e)},error:function(e,t,a){debugger;console.error(t,a)}})}d="Submitted";p="0";var w=JSON.stringify({complainno:u,cpono:n,cvencode:i,cpannum:s,cstatus:d,ccomplain_about:l,cdesc:g,days:p});a.setParameter("data",w);a.setParameter("status",JSON.stringify({status:"postComp"}));await a.execute();r.setParameter("data",w);r.setParameter("status",JSON.stringify({status:"postComp"}));await r.execute();this._handleNavigationToStep(0);this._wizard.discardProgress(this._wizard.getSteps()[0]);location.reload()}.bind(this)}),new sap.m.Button({text:"No",press:function(){m.close();sap.m.MessageToast.show("Cancelled")}})]}).addStyleClass("myCustomDialogClass");m.open()},discardProgress:function(){debugger;this._wizard.discardProgress(this.byId("PanStep"));var e=function(t){for(var a=0;a<t.length;a++){if(t[a].setValue){t[a].setValue("")}if(t[a].getContent){e(t[a].getContent())}}};e(this._wizard.getSteps())},handleSearch:function(e){debugger;var t=this.byId("SearchField").getValue();var a=this.byId("idProductsTable").mBindingInfos.items.binding;if(t===""||t===null||typeof t==="undefined"){a.filter([]);return}var o=[];o.push(new sap.ui.model.Filter({path:"vendor",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"pannum",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"pono",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"type",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"amount",operator:sap.ui.model.FilterOperator.EQ,value1:t}));var r=new sap.ui.model.Filter({filters:o,and:false});a.filter(r)},comments:async function(e){debugger;var t=new sap.m.Dialog({title:"Comments",endButton:new sap.m.Button({text:"Close",press:async function(){t.close()},layoutData:new sap.m.FlexItemData({growFactor:5,alignSelf:"End"})})});t.addContent(new sap.m.VBox({width:"60vw"}));function a(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var a=t+"-"+e;return a}debugger;var o=this.byId("comp_valvw").getText();var r=JSON.stringify({complainno:o});let i="submitcomplaints";debugger;let n=this.getView().getModel().bindContext(`/${i}(...)`);n.setParameter("data",r);n.setParameter("status",JSON.stringify({status:"getComments"}));await n.execute();debugger;let s=n.getBoundContext();let l=s.getValue();let g=l.value;g=JSON.parse(g);var d=g.length;for(var p=0;p<g.length;p++){var u=new sap.suite.ui.commons.TimelineItem("thisuniqid1"+a(),{dateTime:"12/3/34",userNameClickable:false,select:h,text:g[p].comments});t.addContent(u)}var c;function h(e){debugger;c=e.getSource().mProperties.text;m.setValue(c);t.close()}t.open()},onAfterItemAdded:function(e){debugger;var t=this.oView.getModel().sServiceUrl;var a=e.getParameter("item");var o=function(e){debugger;var a={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var o={url:t+`files`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(a)};return new Promise((e,t)=>{$.ajax(o).done((t,a,o)=>{e(t.ID);debugger;c.push(t.ID)}).fail(e=>{t(e)})})};o(a).then(e=>{debugger;var o=t+`files(${e})/content`;a.setUploadUrl(o);var r=this.byId("uploadSet");r.setHttpRequestMethod("PUT");r.uploadItem(a)}).catch(e=>{console.log(e)})},onUploadCompleted:function(e){debugger;var t=this.byId("uploadSet");t.removeAllIncompleteItems();t.getBinding("items").refresh()},onRemovePressed:function(e){debugger;e.preventDefault();e.getParameter("item").getBindingContext().delete();MessageToast.show("Selected file has been deleted")},onOpenPressed:function(e){debugger;e.preventDefault();var t=e.getSource();var a=t.getFileName();var o=this.oView.getModel().sServiceUrl;o=o.replace("/odata/v4/my/","");var r=function(e){var t={url:o+e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})};r(t).then(e=>{var t=window.URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>{console.log(e)})},_download:function(e){debugger;var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntity:function(e){debugger;var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/attachments/files",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,o)=>{e(t.ID);debugger;arr.push(t.ID)}).fail(e=>{t(e)})})},_uploadContent:function(e,t){debugger;var a=`/attachments/Files(${t})/content`;e.setUploadUrl(a);var o=this.byId("uploadSet");o.setHttpRequestMethod("PUT");o.uploadItem(e)},formatThumbnailUrl:function(e){debugger;var t;switch(e){case"image/png":t="sap-icon://card";break;case"text/plain":t="sap-icon://document-text";break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":t="sap-icon://excel-attachment";break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":t="sap-icon://doc-attachment";break;case"application/pdf":t="sap-icon://pdf-attachment";break;default:t="sap-icon://attachment"}return t}})});