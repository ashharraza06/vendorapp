sap.ui.define(["sap/ui/core/mvc/Controller","sap/m/MessageToast","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/ushell/services/UserInfo"],function(e,t,a,o){"use strict";var n;var r;var i;var s;var l;var d;var g;var p;var u;var m;var c=(new sap.ushell.services.UserInfo).getEmail();var b;let v=[];return e.extend("vendrcmplain.controller.App",{onInit:async function(e){debugger;this.byId("step2").setVisible(false);let t="submitcomplaints";let a=this.getView().getModel().bindContext(`/${t}(...)`);var o=JSON.stringify({panno:c});a.setParameter("data",o);a.setParameter("status",JSON.stringify({status:"getvendor"}));await a.execute();debugger;let n=a.getBoundContext();let i=n.getValue();let s=i.value;s=JSON.parse(s);r=s[0].vencode;debugger;this.byId("screen1").attachBrowserEvent("click",function(e){debugger;var t=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable");t.attachSelectionChange(function(e){debugger;var t=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable")._aSelectedPaths[0];var a=sap.ui.getCore().byId("application-vednorinfor-Display-component---App--VendorComplain-progressNavigator").getProgress();if(t!==null&&typeof t!=="undefined"){if(a!==2&&a!==3){sap.ui.getCore().byId("application-vednorinfor-Display-component---App--step2").setVisible(true)}}})});var l=this.getOwnerComponent().createComponent({usage:"screen1",async:true,manifest:true});l.then(function(e){debugger;this.byId("screen1").setComponent(e);this._polistContainer=e}.bind(this));this._wizard=this.byId("VendorComplain");this._oNavContainer=this.byId("wizardNavContainer");this._oWizardContentPage=this.byId("wizardContentPage");e.oSource.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false)},b:function(e){debugger},StepTwo:function(e){debugger;e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false);e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[3].setVisible(false)},StepThree:function(e){debugger;sap.ui.getCore().byId("application-vednorinfor-Display-component---App--step2").setVisible(false);var t=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable")._aSelectedPaths[0];if(t!==null&&typeof t!=="undefined"&&i!=="-"){i=t.substring(t.indexOf("(")+1,t.indexOf(")"));i=t.match(/\('([^']+)'\)/)[1];var a=this.byId("complainTable").mBindingInfos.items.binding;a.filter([new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:i}),new sap.ui.model.Filter({path:"cvencode",operator:sap.ui.model.FilterOperator.EQ,value1:r})]);console.log(i)}var o=null;var n=this.byId("11").mAggregations.items[0].mBindingInfos.items.binding;n.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:o}));if(!d){e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false)}else{e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(true)}e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[2].setVisible(false);this.byId("vencode").setText(r);this.byId("pono").setText(i)},textchange:function(e){debugger;d=this.byId("textcomp").getValue();var t=this.byId("VendorComplain").getCurrentStep();var a=t.split("--");var o=a[a.length-1];if(o!="ReviewStep"){if(d!=""){this.byId("textcomp").setValueState("None");this.byId("textcomp").setValueStateText("");this.byId("revbtn").setVisible(true)}else{this.byId("revbtn").setVisible(false);this.byId("textcomp").setValueState("Error");this.byId("textcomp").setValueStateText("Value is required")}}var n=this.byId("ordr").mProperties.selectedKey;let r=this.byId("ordr").mForwardedAggregations.items;for(var i=0;i<5;i++){var s=r[i].mProperties.key;if(n==s){l=r[i].mProperties.text;break}}this.byId("typ_val").setText(l);this.byId("dsc_val").setValue(d)},StepFour:async function(e){debugger;d=this.byId("textcomp").getValue();e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[1].setVisible(false);e.oSource.oParent.oParent.oParent.oParent.oParent.mAggregations.rootControl.mAggregations.content[0].mAggregations.pages[0].mAggregations.footer.mAggregations.content[3].setVisible(true);var t=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable")._aSelectedPaths[0];if(t!==null&&typeof t!=="undefined"){let e="submitcomplaints";let t=this.oView.getModel().bindContext(`/${e}(...)`);var a=JSON.stringify({pono:i});t.setParameter("data",a);t.setParameter("status",JSON.stringify({status:"getpo"}));await t.execute();let r=t.getBoundContext().getValue();let s=r.value;s=JSON.parse(s);var o=s[0].vendor;var n=s[0].type;var g=s[0].amount;var p=this.byId("revPoTable");p.destroyColumns();var u=new sap.m.Column({header:new sap.m.Text({text:"PO/Invoice Number"})});var m=new sap.m.Column({header:new sap.m.Text({text:"Vendor Code"})});var c=new sap.m.Column({header:new sap.m.Text({text:"Type"})});var b=new sap.m.Column({header:new sap.m.Text({text:"Amount"})});p.addColumn(u);p.addColumn(m);p.addColumn(c);p.addColumn(b);var v=new sap.m.ColumnListItem;v.addCell(new sap.m.Text({text:i}));v.addCell(new sap.m.Text({text:o}));v.addCell(new sap.m.Text({text:n}));v.addCell(new sap.m.Text({text:g}));p.addItem(v)}var h=null;var f=this.byId("112").mAggregations.items[0].mBindingInfos.items.binding;f.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:h}));this.byId("pan_val").setText(s);this.byId("ven_val").setText(r);this.byId("po_val").setText(i);this.byId("typ_val").setText(l);this.byId("dsc_val").setValue(d)},editStepOne:function(){debugger;this._handleNavigationToStep(0)},editStepTwo:function(){debugger;this._handleNavigationToStep(1)},handleWizardBack:function(){debugger;this._handleNavigationToStep(2)},onListPressed:async function(e){debugger;var t=e.oSource.mAggregations.cells[0].mProperties.text;m=this.byId("ta");var a=JSON.stringify({complainno:t});let o="submitcomplaints";debugger;let n=this.getView().getModel().bindContext(`/${o}(...)`);n.setParameter("data",a);n.setParameter("status",JSON.stringify({status:"getComp"}));await n.execute();debugger;let r=n.getBoundContext();let i=r.getValue();let s=i.value;s=JSON.parse(s);if(s[0].cpono=="-"){this.byId("povw").setVisible(false)}else{this.byId("po_valvw").setText(s[0].cpono)}this.byId("ven_valvw").setText(s[0].cvencode);this.byId("pan_valvw").setText(s[0].cpannum);this.byId("status_valvw").setText(s[0].cstatus);this.byId("typ_valvw").setText(s[0].ccomplain_about);this.byId("dsc_valvw").setValue(s[0].cdesc);this.byId("comp_valvw").setText(s[0].complainno);var l=s[0].complainno;var d=this.byId("112vw").mAggregations.items[0].mBindingInfos.items.binding;d.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:l}));this._oNavContainer.to(this.byId("wizardReviewPage"))},change:async function(e){debugger;var t=e.mParameters.step.mProperties.title;if(t=="Preview"){var a=null;var o=this.byId("112").mAggregations.items[0].mBindingInfos.items.binding;o.filter(new sap.ui.model.Filter({path:"size",operator:sap.ui.model.FilterOperator.NE,value1:null}));o.filter(new sap.ui.model.Filter({path:"complaintno",operator:sap.ui.model.FilterOperator.EQ,value1:null}))}var n=sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable")._aSelectedPaths[0];if(n!==null&&typeof n!=="undefined"){this.byId("selPObox").setVisible(true);this.byId("poVbox").setVisible(true);i=n.substring(n.indexOf("(")+1,n.indexOf(")"));i=n.match(/\('([^']+)'\)/)[1];this.byId("po_val").setText(i);this.byId("pono").setText(i);var r=this.byId("complainTable").mBindingInfos.items.binding;r.filter(new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:i}));console.log(i);if(t=="Preview"){let e="submitcomplaints";let t=this.oView.getModel().bindContext(`/${e}(...)`);var s=JSON.stringify({pono:i});t.setParameter("data",s);t.setParameter("status",JSON.stringify({status:"getpo"}));await t.execute();let a=t.getBoundContext().getValue();let o=a.value;o=JSON.parse(o);var l=o[0].vendor;var d=o[0].type;var g=o[0].amount;var p=this.byId("revPoTable");p.destroyColumns();p.removeAllItems();var u=new sap.m.Column({header:new sap.m.Text({text:"PO/Invoice Number"})});var m=new sap.m.Column({header:new sap.m.Text({text:"Vendor Code"})});var c=new sap.m.Column({header:new sap.m.Text({text:"Type"})});var b=new sap.m.Column({header:new sap.m.Text({text:"Amount"})});p.addColumn(u);p.addColumn(m);p.addColumn(c);p.addColumn(b);var v=new sap.m.ColumnListItem;v.addCell(new sap.m.Text({text:i}));v.addCell(new sap.m.Text({text:l}));v.addCell(new sap.m.Text({text:d}));v.addCell(new sap.m.Text({text:g}));p.addItem(v)}}if(t=="Preview"){this.byId("subbtn").setVisible(true)}else{this.byId("subbtn").setVisible(false)}},reviewPress:function(){this._wizard.setCurrentStep(this.byId("ReviewStep"))},withoutpo:function(e){debugger;sap.ui.getCore().byId("polist::poheaderList--fe::table::poheader::LineItem-innerTable").removeSelections();this._wizard.discardProgress(this._wizard.getSteps()[0]);i="-";this._wizard.setCurrentStep(this.byId("PoStep"));this.byId("selPObox").setVisible(false);this.byId("poVbox").setVisible(false);var t=this.byId("revPoTable");t.removeAllItems();this.byId("VendorComplain").nextStep();var a=this.byId("complainTable").mBindingInfos.items.binding;a.filter(new sap.ui.model.Filter({path:"cpono",operator:sap.ui.model.FilterOperator.EQ,value1:i}),new sap.ui.model.Filter({path:"cvencode",operator:sap.ui.model.FilterOperator.EQ,value1:r}))},Step2btn:function(e){debugger;sap.ui.getCore().byId("application-vednorinfor-Display-component---App--step2").setVisible(false);this._wizard.setCurrentStep(this.byId("PoStep"));this.byId("VendorComplain").nextStep()},porowchange:function(e){debugger},onPress:function(e){debugger},wizardCompletedHandler:function(){debugger},_handleNavigationToStep:function(e){var t=function(){this._wizard.goToStep(this._wizard.getSteps()[e]);this._oNavContainer.detachAfterNavigate(t)}.bind(this);this._oNavContainer.attachAfterNavigate(t);this.backToWizardContent()},backToWizardContent:function(){this._oNavContainer.backToPage(this._oWizardContentPage.getId())},handleWizardCancel:function(e){debugger;var t=new sap.m.Dialog({title:"Cancel",resizable:true,draggable:true,content:[new sap.m.Label({text:"Are you sure you want to cancel?"})],buttons:[new sap.m.Button({text:"Yes",press:function(){debugger;t.close();sap.m.MessageToast.show("Cancelled");this._handleNavigationToStep(0);location.reload();this._wizard.discardProgress(this._wizard.getSteps()[0])}.bind(this)}),new sap.m.Button({text:"No",press:function(){t.close()}})]}).addStyleClass("myCustomDialogClass");t.open()},handleWizardSubmit:async function(e){debugger;let t="submitcomplaints";let a=this.oView.getModel().bindContext(`/${t}(...)`);let o="triggerProcess";let n=this.oView.getModel().bindContext(`/${o}(...)`);var m=new sap.m.Dialog({title:"Submit",resizable:true,draggable:true,content:[new sap.m.Label({text:"Are you sure you want to submit for approval?"})],buttons:[new sap.m.Button({text:"Yes",press:async function(){debugger;m.close();var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var o=t+"-"+e;u=o.toString();var c="Complaint No "+u+" sent for approval";sap.m.MessageToast.show(c);var b=this.oView.getModel().sServiceUrl;for(var h=0;h<v.length;h++){var f=v[h];let e=JSON.stringify({ID:f,complaintno:u});var y=b+`files/`+f;$.ajax({url:y,type:"PATCH",contentType:"application/json",data:e,success:function(e){debugger;console.log(e)},error:function(e,t,a){debugger;console.error(t,a)}})}g="Submitted";p="0";var w=this.oView.getModel().sServiceUrl;var x=JSON.stringify({complainno:u,cpono:i,cvencode:r,cpannum:s,cstatus:g,ccomplain_about:l,cdesc:d,days:p});var C=JSON.stringify({complainno:u,cpono:i,cvencode:r,cpannum:s,cstatus:g,ccomplain_about:l,cdesc:d,days:p,baseurl:w});a.setParameter("data",x);a.setParameter("status",JSON.stringify({status:"postComp"}));await a.execute();a.setParameter("data",x);a.setParameter("status",JSON.stringify({status:"getlevel"}));await a.execute();let I=a.getBoundContext();let P=I.getValue();let S=P.value;S=JSON.parse(S);for(var h=0;h<S.length;h++){var T=S[h].level;var A=S[h].employeid;const e=new Date;const t=String(e.getDate()).padStart(2,"0");const o=String(e.getMonth()+1).padStart(2,"0");const n=e.getFullYear();const r=`${t}-${o}-${n}`;var V=JSON.stringify({complainno:u,Begin_DateAND_Time:r,level:T,Employee_ID:A,Notification_Status:g});a.setParameter("data",V);a.setParameter("status",JSON.stringify({status:"postWorkflow"}));await a.execute()}n.setParameter("data",C);n.setParameter("status",JSON.stringify({status:""}));await n.execute();sap.m.MessageToast.show("Saved successfully");this._handleNavigationToStep(0);this._wizard.discardProgress(this._wizard.getSteps()[0]);location.reload()}.bind(this)}),new sap.m.Button({text:"No",press:function(){m.close();sap.m.MessageToast.show("Cancelled")}})]}).addStyleClass("myCustomDialogClass");m.open()},discardProgress:function(){debugger;this._wizard.discardProgress(this.byId("PanStep"));var e=function(t){for(var a=0;a<t.length;a++){if(t[a].setValue){t[a].setValue("")}if(t[a].getContent){e(t[a].getContent())}}};e(this._wizard.getSteps())},handleSearch:function(e){debugger;var t=this.byId("SearchField").getValue();var a=this.byId("idProductsTable").mBindingInfos.items.binding;if(t===""||t===null||typeof t==="undefined"){a.filter([]);return}var o=[];o.push(new sap.ui.model.Filter({path:"vendor",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"pannum",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"pono",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"type",operator:sap.ui.model.FilterOperator.EQ,value1:t}));o.push(new sap.ui.model.Filter({path:"amount",operator:sap.ui.model.FilterOperator.EQ,value1:t}));var n=new sap.ui.model.Filter({filters:o,and:false});a.filter(n)},comments:async function(e){debugger;var t=new sap.m.Dialog({title:"Comments",endButton:new sap.m.Button({text:"Close",press:async function(){t.close()},layoutData:new sap.m.FlexItemData({growFactor:5,alignSelf:"End"})})});t.addContent(new sap.m.VBox({width:"60vw"}));function a(){var e=Math.floor(Math.random()*1e6);var t=(new Date).getTime();var a=t+"-"+e;return a}debugger;var o=this.byId("comp_valvw").getText();var n=JSON.stringify({complainno:o});let r="submitcomplaints";debugger;let i=this.getView().getModel().bindContext(`/${r}(...)`);i.setParameter("data",n);i.setParameter("status",JSON.stringify({status:"getComments"}));await i.execute();debugger;let s=i.getBoundContext();let l=s.getValue();let d=l.value;d=JSON.parse(d);var g=d.length;for(var p=0;p<d.length;p++){var u=new sap.suite.ui.commons.TimelineItem("thisuniqid1"+a(),{dateTime:d[p].createdAt,userNameClickable:false,select:b,text:d[p].comments});t.addContent(u)}var c;function b(e){debugger;c=e.getSource().mProperties.text;m.setValue(c);t.close()}t.open()},onAfterItemAdded:function(e){debugger;var t=this.oView.getModel().sServiceUrl;var a=e.getParameter("item");var o=function(e){debugger;var a={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var o={url:t+`files`,method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(a)};return new Promise((e,t)=>{$.ajax(o).done((t,a,o)=>{e(t.ID);debugger;v.push(t.ID);b=t.ID}).fail(e=>{t(e)})})};o(a).then(e=>{debugger;var o=t+`files(${e})/content`;a.setUploadUrl(o);var n=this.byId("uploadSet");n.setHttpRequestMethod("PUT");n.uploadItem(a)}).catch(e=>{console.log(e)})},onUploadCompleted:async function(e){debugger;var t=this.byId("uploadSet");t.removeAllIncompleteItems();let a="submitcomplaints";var o=this.getView().getModel().bindContext(`/${a}(...)`);var n=JSON.stringify({uid:b,createdBy:c});o.setParameter("data",n);o.setParameter("status",JSON.stringify({status:"patchattach"}));await o.execute();t.getBinding("items").refresh()},onRemovePressed:function(e){debugger;e.preventDefault();e.getParameter("item").getBindingContext().delete();sap.m.MessageToast.show("Selected file has been deleted")},onOpenPressed:function(e){debugger;e.preventDefault();var t=e.getSource();var a=t.getFileName();var o=this.oView.getModel().sServiceUrl;o=o.replace("/odata/v4/my/","");var n=function(e){var t={url:o+e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})};n(t).then(e=>{var t=window.URL.createObjectURL(e);window.open(t,"_blank")}).catch(e=>{console.log(e)})},_download:function(e){debugger;var t={url:e.getUrl(),method:"GET",headers:{"Content-type":"application/octet-stream"},xhrFields:{responseType:"blob"}};return new Promise((e,a)=>{$.ajax(t).done(t=>{e(t)}).fail(e=>{a(e)})})},_createEntity:function(e){debugger;var t={mediaType:e.getMediaType(),fileName:e.getFileName(),size:e.getFileObject().size};var a={url:"/attachments/files",method:"POST",headers:{"Content-type":"application/json"},data:JSON.stringify(t)};return new Promise((e,t)=>{$.ajax(a).done((t,a,o)=>{e(t.ID);debugger;arr.push(t.ID)}).fail(e=>{t(e)})})},_uploadContent:function(e,t){debugger;var a=`/attachments/Files(${t})/content`;e.setUploadUrl(a);var o=this.byId("uploadSet");o.setHttpRequestMethod("PUT");o.uploadItem(e)},formatThumbnailUrl:function(e){debugger;var t;switch(e){case"image/png":t="sap-icon://card";break;case"text/plain":t="sap-icon://document-text";break;case"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet":t="sap-icon://excel-attachment";break;case"application/vnd.openxmlformats-officedocument.wordprocessingml.document":t="sap-icon://doc-attachment";break;case"application/pdf":t="sap-icon://pdf-attachment";break;default:t="sap-icon://attachment"}return t}})});